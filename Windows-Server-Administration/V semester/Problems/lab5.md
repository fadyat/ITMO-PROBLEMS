# Работа с томами хранения данных в Windows Server.

## Цель работы

Получить представление и практические навыки работы по настройки томов хранения данных, организации программного RAID и
использование протокола iSCSI.

Необходимо:

- Установленная на компьютере среда виртуализации ORACLE Virtual Box
- Образы виртуальных жёстких дисков операционных систем Windows Server 2012/2016.

## Краткие теоретические сведения:

ОС Windows Server позволяет гибко управлять файловым хранением, создавать программные RAID, использовать SAN и
разворачивать отказоустойчивые сетевые файловые службы. Все эти возможности можно реализовать как с помощью GUI, так и с
помощью PowerShell, а некоторые с помощью консольных команд, таких как diskpart. Windows Server поддерживает следующие
программные RAID: JBOD, RAID0, RAID1, RAID5.
В Windows Server встроены программные компоненты для работы с iSCSI.

## Порядок выполнения работы:

### Часть 1. Подготовительная.

- Для выполнения работы понадобится две виртуальные машины Windows Server (могут использоваться машины, созданные в
  работе №4). Для удобства будем далее называть компьютеры так: s1 – первый сервер с AD DS, s2 – второй сервер, член
  домена.
- Сделайте снимки исходного состояния для каждой из машин.
- Если у вы используете готовые машины из работы №4, то сделайте снимки исходного состояния для каждой из машин.
  Остановите на машинах s1 и s2 DHCP сервера. Настройте виртуальные машины так, чтобы они оказались в одной,
  изолированной LAN и для каждой из машин был выделен свой IP адрес из сети 10.0.0.0/8.
- Проверьте доступность по сети каждой машины с каждой машины с помощью утилиты ping и корректную работу домена AD.

### Часть 2. Управление разделами

- Добавите в параметрах виртуальной машины s1 4 жестких диска d1-d4 по 4 Гб каждый (для экономии места используйте
  динамические диски).
- На диске d1 с помощью Диспетчера дисков создайте простой том, c файловой системой NTFS размером 1 Гб и смонтируйте его
  в каталог Volume1 на диск C:\
- С помощью PowerShell выведите сведения о подключенных дисках как физических устройствах.
- С помощью PowerShell выведите сведения о подключенных дисках как логических устройствах.
- С помощью PowerShell выведите сведения о разделах.
- С помощью PowerShell выведите сведения о томах.
- В Диспетчере дисков переведите подключенные диски в offline режим (режим вне сети).

Напишите скрипт на Power Shell, который:

- Выводит перечень дисков
- Запрашивает номер диска
- Выводит предупреждение, что все данные на диске будут стерты.
- Если пользователь отказывается – завершает работу, если соглашается, то продолжает и
- Выполняет необходимые операции, чтобы создать на диске том с файловой системой NTFS и подключить его на букву T:
- Проверит диск T: на наличие ошибок, выведет результаты проверки.
- Выведет сведения о томе.

Удалите все созданные тома и разделы, переведите диски, кроме исходного в состояние offline (вне сети).

### Часть 3. Работа с RAID

- С помощью Диспетчера дисков или утилиты diskpart создайте на дисках d1, d2, d3 том с RAID5. Подключите его на букву
  диска W:
- Создайте на диске W: несколько файлов.
- Выключите виртуальную машину s1. В свойствах виртуальной машины удалите диск d3.
- Запустите машину s1.
- Проверьте доступность файлов на диске W:
- Через Диспетчер дисков определите состояние RAID5. Сделайте скриншот, сохраните его в файл.
- Через Диспетчер дисков восстановите RAID5 с помощью диска d4. Сделайте скриншот, сохраните его в файл.
- Выключите виртуальную машину s1, подключите диск d3. Включите виртуальную машину и удалите все тома и разделы на
  дисках d1-d4.
- Напишите скрипт для утилиты diskpart который создает том RAID5, на дисках d1-d4 и монтирует его на букву диска V:.
  Используйте скрипт, для создания диска.

### Часть 4. Подключение дисков через iSCSI

- Будет необходимо на виртуальных машинах s1 и s2 реализовать схему, при которой на машине s1 на диске V: хранить
  виртуальный жесткий диск и монтировать его на машине s2 на букву диска R: по протоколу iSCSI.
- Дайте определения понятиям роли iSCSI Initiator и iSCSI Target.
- Определите какая из машин будет выступать в роли iSCSI Initiator, а какая в роли iSCSI Target. Установите
  соответствующие компоненты на нужных виртуальных машинах через Диспетчер Серверов или Power Shell.
- На виртуальной машине s1 создайте виртуальный диск iSCSI с именем LUN1 и объемом 5 Гб.
- Подключите его к машине s2, указав ее по IP адресу.
- На машине s2 подключите LUN1 в качестве диска (ключевые слова-подсказки «Обнаружение – Обнаружение портала» «Конечные
  объекты» или «Discovery – Discovery Portal» и «Targets»).
- С помощью PowerShell выведите сведения о подключенных дисках как физических устройствах.
- С помощью PowerShell выведите сведения о подключенных дисках как логических устройствах.
- С помощью PowerShell выведите сведения о разделах.
- С помощью PowerShell выведите сведения о томах.
- C помощью PowerShell выведите только диски, подключенные к машине s2 по iSCSI.

### Часть 5. Работа со Storage Spaces

- Добавьте к конфигурации машины s1 7 дисков по 10 Гб ((для экономии места используйте динамические диски).
- С помощью графического интерфейса Server Manager создайте пул из всех этих дисков.
- С помощью PowerShell создайте на этом томе виртуальный диск в режиме Two-way-mirror с максимальным объемом. Командой
  PowerShell определите его объем.
- Удалите виртуальный диск.
- С помощью PowerShell создайте на этом томе виртуальный диск в режиме Parity с максимальным объемом и c
  отказоустойчивостью по отношению к потере 2-х дисков. Командой PowerShell определите его объем.

### Вопросы:

- В чем разница возможностей динамических и базовых дисков в Windows?
- В чем разница устройства динамических и базовых дисков в Windows?
- Сопоставьте данные, полученные в части 2, п. 3-6. Соотнесите объекты, с которыми вы работали с элементами стека
  хранения Windows. Опишите результаты сопоставления и сравнения.
- Каков будет размер каталога Volume1 после выполнения п. 2 части 2? Почему?
- Какой будет объем диска W: после выполнения п.1 части 3 и диска V: после п.9 части 3? Почему?
- Дайте определения понятиям iSCSI Initiator, iSCSI Target и IQN (iSCSI qualified name).
- Как с помощью PowerShell установить iSCSI Target на локальный хост?
- При создании виртуального диска iSCSI возможно выбрать три типа диска Фиксированный, Динамический и Разностный. В чем
  разница этих типов? Придумайте реальные ситуации, когда целесообразно применять каждый из трех типов дисков.
- Сравните данные, полученные в части 2, п. 3-6 с данными, полученными в части 4, п. 7-10.
- Чем отличается по-вашему программный RAID и Storage Spaces? Какие аналогии из мира Linux вы можете привести?
- Как вывести информацию о пуле Storage Spaces с помощью PowerShell?
- Как создать пул Storage Spaces с помощью PowerShell?
- Сравните объемы дисков из части 5 п.3 и п.5. Какой диск больше? Почему?

### Артефакты:

- Напишите конвейер PowerShell, которой в гостевой Windows Server выводит информацию только о тех дисках, которые были
  подключены в части 3, п. 1.
- Скрипт из части 2, п.8.
- Скриншоты окон из части 3 п. 6 и 7.
- Приведите команду из части 4, п. 11.
- Команды из Части 5, п.3,4,5.

