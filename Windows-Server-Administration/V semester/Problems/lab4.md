# Развертывание в середе Windows Server сетевых инфраструктурных сервисов на примере DHCP.

## Цель работы:

Получить представление и практические навыки работы по развертыванию и управлению сетевыми
инфраструктурными сервисами на примере DHCP и IPAM в середе Windows Server, освоить основные понятия, связанные с
работой DHCP сервера.

Необходимо:

- Установленная на компьютере среда виртуализации ORACLE Virtual Box
- Образы виртуальных жёстких дисков операционных систем Windows Server 2012/2016.

## Краткие теоретические сведения:

ОС Windows Server содержит необходимые для работы корпоративной сети сервисы. Все эти серверы могут развертываться как с
помощью GUI, так и с помощью PowerShell, а некоторые с помощью консольных команд, таких как netsh. Кроме того в состав
ОС Windows включены консольные команды для управления сервисами (net, sc и др.).

К таким сервисам относится DHCP серве. Протокол DHCP (Dynamic Host Configuration Protocol — протокол динамической
настройки узла) — сетевой протокол, позволяющий узлам в сети автоматически получать необходимые параметры (IP-адрес,
маску, адреса шлюза и DNS, имя хоста и другие параметры).

Обеспечивает работу сервера DHCP пара клиент и сервер, каждый из них является системной службой. DHCP-сервер содержит
настройки одной или нескольких областей (scope). Для области настраиваются пул (pool) адресов, и опции (options). Из
пула по запросу клиентов сервер выделяет адреса на определенное время или навсегда. Можно создать предопределённые
назначения адресов.

## Порядок выполнения работы:

### Часть 1. Подготовка инфраструктуры

- Подготовьте инфраструктуру (можете использовать инфраструктуру от предыдущих работ), включающую:
- три виртуальные машины – 2 сервера (windows server) и 1 машину – клиента (любая ОС).
- Все машины в одном LAN.
- На одном из серверов должен быть развернута AD DS.
- Все ОС должны быть в одном домене.
- Для удобства будем далее называть компьютеры так: s1 – первый сервер с AD DS, s2 – второй сервер, c1 - клиент.
- Сделайте снимки исходного состояния для каждой из машин.

### Часть 2. Развёртывание DHCP сервера

- Запустите машину s1.
- Назначьте на сетевой интерфейс адрес 10.0.0.1/8. Отключите IPv6.
- Добавите роль DHCP-сервер через ServerManager.
- Запустите консоль DHCP-сервера и сконфигурируйте его так чтобы:
- Клиентам выдавали 100 адресов, начиная с 10.0.0.100
- Из этого диапазона были исключены для назначения адреса 10.0.0.195-10.0.0.200
- Адреса выдавались на 1 час.
- Адрес шлюза и DNS – 10.0.0.1.
- Родительский домен – советует названию вашего домена AD DS.
- Создайте Резервирование для MAC адреса 00-01-02-03-04-05, для которого назначается IP адрес 10.0.0.199.
- Создайте DNS-политику (не политику AD DS!), которая работает аналогично настройкам всей области, но для узлов с MAC
  адресами, начинающимися на AA-01-02, устанавливает адрес шлюза по умолчанию на 10.10.10.10
- Сделайте архив конфигурации DHCP сервера в каталог C:\bak-dhcp\
- С помощью команды netsh (контексты dhcp server) выведите дамп конфигурации. Сохраните его в текстовый файл. (!)

### Часть 3. Работа клиента DHCP

- Включите виртуальную машину с1.
- На сетевом интерфейсе отключите IPv6 и для IPv4 включите получение адресов автоматически.
- С помощью команды ipconfig определите полученные конфигурации и время аренды. Сохраните консольный вывод в файл. (!)
- Найдите назначение адреса в консоли управления сервером DHCP.
- На сервере s1 для DHCP сервера и протокола IPv4 отобразите сводную статистику работы сервера. Сохраните скриншот окна.
- На c1 помощью утилиты ipconfig освободите резерв адреса и запросите адрес заново.
- В диспетчере устройств, в параметрах сетевой платы задайте MAC адрес 00-01-02-03-04-05. С помощью команды ipconfig
  определите полученные конфигурации и время аренды. Сохраните консольный вывод в файл. (!)
- В диспетчере устройств, в параметрах сетевой платы задайте MAC адрес AA-01-02-03-04-05. С помощью команды ipconfig
  определите полученные конфигурации и время аренды. Сохраните консольный вывод в файл. (!)
- На сервере s1 в консоли управления DHCP сервером ознакомитесь с выданными лицензиями на адреса.

### Часть 4. Организация отказоустойчивого DHCP сервиса

- Запустите виртуальную машину s2.
- Назначьте на сетевой интерфейс адрес 10.0.0.2/8. Отключите IPv6.
- Установите DHCP сервер, но не настраивайте на нем области.
- На сервере s1 проведите настройку отработки отказа для созданной области (настройте Failover).
- Настройте сервер-партнер s2 так чтобы:
- Он работал в режиме Горячей замены в ждущем режиме
- Имел 35% адресов пула для резерва
- Время упреждения клиента составляло 30 минут
- Интервал переключения 1 минуту
- Секретное слово для проверки – «123»
- Визуально убедитесь в репликации области на s2.
- На сервере s1 сделайте скриншот окна свойств области, закладка Обработка отказа. Сохраните скриншот. (!)
- На машине c1 с помощью команды ipconfig определите, какие адреса получены и какой DHCP сервер их выдал. Сохраните
  консольный вывод в файл. (!)
- В свойствах виртуальной машины s1 отключите сетевой кабель. На сервере s2 сделайте скриншот окна свойств области,
  закладка Обработка отказа. Сохраните скриншот. (!)
- На машине с1 отключите и снова включите сетевой интерфейс. с помощью команды ipconfig определите, какие адреса
  получены и какой DHCP сервер их выдал. Сохраните консольный вывод в файл. (!)
- В свойствах виртуальной машины s1 подключите сетевой кабель обратно.

### Часть 5. Автоматизация управления DHCP сервисом с помощью PowerShell

- Исходя из того что, работают хосты s1, s2, c1 и на хостах s1 и s2 назначены адреса 10.0.0.1\8 и 10.0.0.2\8 написать
  скрипт, который добавляет роли DHCP-серверов на s1 и s2 и конфигурирует службы согласно п.5 части 2 и п.6 части 4.
  Параметры конфигурации (адреса, имена, значения времени и др.) следует хранить в текстовом файле. Для проверки скрипта
  можете восстановить снапшоты виртуальных машин.

### Содержание отчета

Требуется подготовить отчеты в формате DOC\DOCX или PDF. Отчет содержит титульный лист, артефакты выполнения и ответы на
вопросы.

Вопросы:

- Раскройте смысл понятий в контексте DHCP: область, опция, аренда, полтика.
- Какие компоненты устанавливаются мастером при добавлении роли DHCP-сервер?
- Какие опции DHCP были задействованы в Части 2 ?
- Какие режимы работы с точки зрения обеспечения надежности, существуют для DHCP сервера в Windows Server? Объясните
  разницу.
- Поясните параметры Максимальное время упреждения для клиента (Maximum Client Lead Time) и Интервал переключения
  состояния (State Switchover Interval). Что они означают? Что произойдет при сбое партнёра если не задавать Интервал
  переключения состояния?
- Что из себя представляет архивная копия DHCP-сервера?
- Как переименовать хост с помощью PowerShell?

Артефакты:

- Приведите секцию добавления области из файла дампа конфигурации из п.8, Часть 2.
- Приведите консольный выводы и скриншоты п. 3, 7, 8, 9 части 3. Дайте пояснения, объясните различия.
- Приведите консольный выводы и скриншоты п. 7-10 части 4. Дайте пояснения, объясните различия.
- Приведите PS команду экспорта конфигурации DHCP сервера в файл.
- Приведите текст скрипта Части 5.


